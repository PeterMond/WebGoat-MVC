€L
FC:\PruebasNET\WebGoat-MVC\WebGoat.MVC\Controllers\AccountController.cs
	namespace 	
WebGoat
 
. 
MVC 
. 
Controllers !
{ 
public 

class 
AccountController "
:# $

Controller% /
{		 
public 
ActionResult 
LogOn !
(! "
)" #
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
ActionResult 
LogOn !
(! "

LogOnModel" ,
model- 2
,2 3
string4 :
	returnUrl; D
)D E
{ 	
if 
( 

ModelState 
. 
IsValid "
)" #
{ 
if 
( 

Membership 
. 
ValidateUser +
(+ ,
model, 1
.1 2
UserName2 :
,: ;
model< A
.A B
PasswordB J
)J K
)K L
{ 
FormsAuthentication '
.' (
SetAuthCookie( 5
(5 6
model6 ;
.; <
UserName< D
,D E
modelF K
.K L

RememberMeL V
)V W
;W X
if 
( 
Url 
. 

IsLocalUrl &
(& '
	returnUrl' 0
)0 1
&&2 4
	returnUrl5 >
.> ?
Length? E
>F G
$numH I
&&J L
	returnUrlM V
.V W

StartsWithW a
(a b
$strb e
)e f
&& 
! 
	returnUrl %
.% &

StartsWith& 0
(0 1
$str1 5
)5 6
&&7 9
!: ;
	returnUrl; D
.D E

StartsWithE O
(O P
$strP U
)U V
)V W
{ 
return   
Redirect   '
(  ' (
	returnUrl  ( 1
)  1 2
;  2 3
}!! 
else"" 
{## 
return$$ 
RedirectToAction$$ /
($$/ 0
$str$$0 7
,$$7 8
$str$$9 ?
)$$? @
;$$@ A
}%% 
}&& 
else'' 
{(( 

ModelState)) 
.)) 
AddModelError)) ,
()), -
$str))- /
,))/ 0
$str))1 c
)))c d
;))d e
}** 
}++ 
return.. 
View.. 
(.. 
model.. 
).. 
;.. 
}// 	
public44 
ActionResult44 
LogOff44 "
(44" #
)44# $
{55 	
FormsAuthentication66 
.66  
SignOut66  '
(66' (
)66( )
;66) *
return88 
RedirectToAction88 #
(88# $
$str88$ +
,88+ ,
$str88- 3
)883 4
;884 5
}99 	
public>> 
ActionResult>> 
Register>> $
(>>$ %
)>>% &
{?? 	
return@@ 
View@@ 
(@@ 
)@@ 
;@@ 
}AA 	
[FF 	
HttpPostFF	 
]FF 
publicGG 
ActionResultGG 
RegisterGG $
(GG$ %
RegisterModelGG% 2
modelGG3 8
)GG8 9
{HH 	
ifII 
(II 

ModelStateII 
.II 
IsValidII "
)II" #
{JJ "
MembershipCreateStatusLL &
createStatusLL' 3
;LL3 4

MembershipMM 
.MM 

CreateUserMM %
(MM% &
modelMM& +
.MM+ ,
UserNameMM, 4
,MM4 5
modelMM6 ;
.MM; <
PasswordMM< D
,MMD E
modelMMF K
.MMK L
EmailMML Q
,MMQ R
nullMMS W
,MMW X
nullMMY ]
,MM] ^
trueMM_ c
,MMc d
nullMMe i
,MMi j
outNN& )
createStatusNN* 6
)NN6 7
;NN7 8
ifPP 
(PP 
createStatusPP  
==PP! #"
MembershipCreateStatusPP$ :
.PP: ;
SuccessPP; B
)PPB C
{QQ 
FormsAuthenticationRR '
.RR' (
SetAuthCookieRR( 5
(RR5 6
modelRR6 ;
.RR; <
UserNameRR< D
,RRD E
falseRRF K
)RRh i
;RRi j
returnSS 
RedirectToActionSS +
(SS+ ,
$strSS, 3
,SS3 4
$strSS5 ;
)SS; <
;SS< =
}TT 
elseUU 
{VV 

ModelStateWW 
.WW 
AddModelErrorWW ,
(WW, -
$strWW- /
,WW/ 0
ErrorCodeToStringWW1 B
(WWB C
createStatusWWC O
)WWO P
)WWP Q
;WWQ R
}XX 
}YY 
return\\ 
View\\ 
(\\ 
model\\ 
)\\ 
;\\ 
}]] 	
[bb 	
	Authorizebb	 
]bb 
publiccc 
ActionResultcc 
ChangePasswordcc *
(cc* +
)cc+ ,
{dd 	
returnee 
Viewee 
(ee 
)ee 
;ee 
}ff 	
[kk 	
	Authorizekk	 
]kk 
[ll 	
HttpPostll	 
]ll 
publicmm 
ActionResultmm 
ChangePasswordmm *
(mm* +
ChangePasswordModelmm+ >
modelmm? D
)mmD E
{nn 	
ifoo 
(oo 

ModelStateoo 
.oo 
IsValidoo "
)oo" #
{pp 
boolss #
changePasswordSucceededss ,
;ss, -
trytt 
{uu 
MembershipUservv "
currentUservv# .
=vv/ 0

Membershipvv1 ;
.vv; <
GetUservv< C
(vvC D
UservvD H
.vvH I
IdentityvvI Q
.vvQ R
NamevvR V
,vvV W
truevvX \
)vvo p
;vvp q#
changePasswordSucceededww +
=ww, -
currentUserww. 9
.ww9 :
ChangePasswordww: H
(wwH I
modelwwI N
.wwN O
OldPasswordwwO Z
,wwZ [
modelww\ a
.wwa b
NewPasswordwwb m
)wwm n
;wwn o
}xx 
catchyy 
(yy 
	Exceptionyy  
)yy  !
{zz #
changePasswordSucceeded{{ +
={{, -
false{{. 3
;{{3 4
}|| 
if~~ 
(~~ #
changePasswordSucceeded~~ +
)~~+ ,
{ 
return
ÄÄ 
RedirectToAction
ÄÄ +
(
ÄÄ+ ,
$str
ÄÄ, C
)
ÄÄC D
;
ÄÄD E
}
ÅÅ 
else
ÇÇ 
{
ÉÉ 

ModelState
ÑÑ 
.
ÑÑ 
AddModelError
ÑÑ ,
(
ÑÑ, -
$str
ÑÑ- /
,
ÑÑ/ 0
$str
ÑÑ1 t
)
ÑÑt u
;
ÑÑu v
}
ÖÖ 
}
ÜÜ 
return
ââ 
View
ââ 
(
ââ 
model
ââ 
)
ââ 
;
ââ 
}
ää 	
public
èè 
ActionResult
èè #
ChangePasswordSuccess
èè 1
(
èè1 2
)
èè2 3
{
êê 	
return
ëë 
View
ëë 
(
ëë 
)
ëë 
;
ëë 
}
íí 	
private
ññ 
static
ññ 
string
ññ 
ErrorCodeToString
ññ /
(
ññ/ 0$
MembershipCreateStatus
ññ0 F
createStatus
ññG S
)
ññS T
{
óó 	
switch
öö 
(
öö 
createStatus
öö  
)
öö  !
{
õõ 
case
úú $
MembershipCreateStatus
úú +
.
úú+ ,
DuplicateUserName
úú, =
:
úú= >
return
ùù 
$str
ùù Z
;
ùùZ [
case
üü $
MembershipCreateStatus
üü +
.
üü+ ,
DuplicateEmail
üü, :
:
üü: ;
return
†† 
$str
°° v
;
°°v w
case
££ $
MembershipCreateStatus
££ +
.
££+ ,
InvalidPassword
££, ;
:
££; <
return
§§ 
$str
§§ c
;
§§c d
case
¶¶ $
MembershipCreateStatus
¶¶ +
.
¶¶+ ,
InvalidEmail
¶¶, 8
:
¶¶8 9
return
ßß 
$str
ßß j
;
ßßj k
case
©© $
MembershipCreateStatus
©© +
.
©©+ ,
InvalidAnswer
©©, 9
:
©©9 :
return
™™ 
$str
™™ u
;
™™u v
case
¨¨ $
MembershipCreateStatus
¨¨ +
.
¨¨+ ,
InvalidQuestion
¨¨, ;
:
¨¨; <
return
≠≠ 
$str
≠≠ w
;
≠≠w x
case
ØØ $
MembershipCreateStatus
ØØ +
.
ØØ+ ,
InvalidUserName
ØØ, ;
:
ØØ; <
return
∞∞ 
$str
∞∞ e
;
∞∞e f
case
≤≤ $
MembershipCreateStatus
≤≤ +
.
≤≤+ ,
ProviderError
≤≤, 9
:
≤≤9 :
return
≥≥ 
$str¥¥ ≥
;¥¥≥ ¥
case
∂∂ $
MembershipCreateStatus
∂∂ +
.
∂∂+ ,
UserRejected
∂∂, 8
:
∂∂8 9
return
∑∑ 
$str∏∏ ±
;∏∏± ≤
default
∫∫ 
:
∫∫ 
return
ªª 
$strºº ü
;ººü †
}
ΩΩ 
}
ææ 	
}
¡¡ 
}¬¬ Õ7
CC:\PruebasNET\WebGoat-MVC\WebGoat.MVC\Controllers\HomeController.cs
	namespace 	
WebGoat
 
. 
MVC 
. 
Controllers !
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
public		 
ActionResult		 
Index		 !
(		! "
)		" #
{

 	
ViewBag 
. 
Message 
= 
$str 7
;7 8
return 
View 
( 
) 
; 
} 	
public 
ActionResult 
About !
(! "
)" #
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpGet	 
] 
[ 	

ActionName	 
( 
$str 
)  
]  !
public 
ActionResult 
	Injection %
(% &
)& '
{ 	
return 
View 
( 
$str #
)# $
;$ %
} 	
[ 	
HttpPost	 
] 
[ 	

ActionName	 
( 
$str 
)  
]  !
public 
ActionResult 
	Injection %
(% &
string& ,

srchString- 7
)7 8
{   	
string!! 
msg!! 
=!! 
$str!! 6
;!!6 7
string## 
connectionString## #
=##$ %
$str$$ @
+%% 
$str%% ,
;%%, -
string(( 
queryString(( 
=((  
$str)) M
+** 
$str** 2
+++ 
$str++ ,
;++, -
int.. 

paramValue.. 
=.. 
$num.. 
;.. 
using33 
(33 
var33 

connection33 !
=33" #
new44 
SqlConnection44 !
(44! "
connectionString44" 2
)442 3
)443 4
{55 
var77 
command77 
=77 
new77 !

SqlCommand77" ,
(77, -
queryString77- 8
,778 9

connection77: D
)77D E
;77E F
command88 
.88 

Parameters88 "
.88" #
AddWithValue88# /
(88/ 0
$str880 =
,88= >

paramValue88? I
)88I J
;88J K
try== 
{>> 

connection?? 
.?? 
Open?? #
(??# $
)??$ %
;??% &
SqlDataReader@@ !
reader@@" (
=@@) *
command@@+ 2
.@@2 3
ExecuteReader@@3 @
(@@@ A
)@@A B
;@@B C
whileAA 
(AA 
readerAA !
.AA! "
ReadAA" &
(AA& '
)AA' (
)AA( )
{BB 
msgCC 
+=CC 
stringCC %
.CC% &
FormatCC& ,
(CC, -
$strCC- >
,CC> ?
readerDD- 3
[DD3 4
$numDD4 5
]DD5 6
,DD6 7
readerDD8 >
[DD> ?
$numDD? @
]DD@ A
,DDA B
readerDDC I
[DDI J
$numDDJ K
]DDK L
)DDL M
;DDM N
}EE 
readerFF 
.FF 
CloseFF  
(FF  !
)FF! "
;FF" #
}GG 
catchHH 
(HH 
	ExceptionHH  
exHH! #
)HH# $
{II 
msgJJ 
+=JJ 
(JJ 
exJJ 
.JJ 
MessageJJ &
)JJ& '
;JJ' (
}KK 
}LL 
returnMM 
ViewMM 
(MM 
$strMM #
)MM# $
;MM$ %
}NN 	
[PP 	

ActionNamePP	 
(PP 
$strPP 
)PP 
]PP 
publicQQ 
ActionResultQQ 
CrossSiteScriptingQQ .
(QQ. /
)QQ/ 0
{RR 	
returnSS 
ViewSS 
(SS 
$strSS 
)SS  
;SS  !
}TT 	
[VV 	

ActionNameVV	 
(VV 
$strVV !
)VV! "
]VV" #
publicWW 
ActionResultWW 

BrokenAuthWW &
(WW& '
)WW' (
{XX 	
returnYY 
ViewYY 
(YY 
$strYY 
)YY  
;YY  !
}ZZ 	
[\\ 	

ActionName\\	 
(\\ 
$str\\ (
)\\( )
]\\) *
public]] 
ActionResult]] 
InsecureReference]] -
(]]- .
)]]. /
{^^ 	
return__ 
View__ 
(__ 
$str__ 
)__  
;__  !
}`` 	
[bb 	

ActionNamebb	 
(bb 
$strbb 
)bb 
]bb 
publiccc 
ActionResultcc #
CrossSiteRequestForgerycc 3
(cc3 4
)cc4 5
{dd 	
returnee 
Viewee 
(ee 
$stree 
)ee  
;ee  !
}ff 	
[hh 	

ActionNamehh	 
(hh 
$strhh (
)hh( )
]hh) *
publicii 
ActionResultii $
SecurityMisconfigurationii 4
(ii4 5
)ii5 6
{jj 	
returnkk 
Viewkk 
(kk 
$strkk 
)kk  
;kk  !
}ll 	
[nn 	

ActionNamenn	 
(nn 
$strnn -
)nn- .
]nn. /
publicoo 
ActionResultoo !
InsecureCryptoStorageoo 1
(oo1 2
)oo2 3
{pp 	
returnqq 
Viewqq 
(qq 
$strqq 
)qq  
;qq  !
}rr 	
[tt 	

ActionNamett	 
(tt 
$strtt $
)tt$ %
]tt% &
publicuu 
ActionResultuu 
AccessFailureuu )
(uu) *
)uu* +
{vv 	
returnww 
Viewww 
(ww 
$strww 
)ww  
;ww  !
}xx 	
[zz 	

ActionNamezz	 
(zz 
$strzz %
)zz% &
]zz& '
public{{ 
ActionResult{{ 
TransportLayer{{ *
({{* +
){{+ ,
{|| 	
return}} 
View}} 
(}} 
$str}} 
)}}  
;}}  !
}~~ 	
[
ÄÄ 	

ActionName
ÄÄ	 
(
ÄÄ 
$str
ÄÄ %
)
ÄÄ% &
]
ÄÄ& '
public
ÅÅ 
ActionResult
ÅÅ 
InvalidForward
ÅÅ *
(
ÅÅ* +
)
ÅÅ+ ,
{
ÇÇ 	
return
ÉÉ 
View
ÉÉ 
(
ÉÉ 
$str
ÉÉ 
)
ÉÉ  
;
ÉÉ  !
}
ÑÑ 	
}
ÖÖ 
}ÜÜ ∫
4C:\PruebasNET\WebGoat-MVC\WebGoat.MVC\Global.asax.cs
	namespace 	
WebGoat
 
. 
MVC 
{ 
public

 

class

 
MvcApplication

 
:

  !
HttpApplication

" 1
{ 
public 
static 
void !
RegisterGlobalFilters 0
(0 1"
GlobalFilterCollection1 G
filtersH O
)O P
{ 	
filters 
. 
Add 
( 
new  
HandleErrorAttribute 0
(0 1
)1 2
)2 3
;3 4
} 	
public 
static 
void 
RegisterRoutes )
() *
RouteCollection* 9
routes: @
)@ A
{ 	
routes 
. 
IgnoreRoute 
( 
$str ;
); <
;< =
routes 
. 
MapRoute 
( 
$str 
, 
$str ,
,, -
new 
{ 

controller 
=  !
$str" (
,( )
action* 0
=1 2
$str3 :
,: ;
id< >
=? @
UrlParameterA M
.M N
OptionalN V
}V W
) 
; 
} 	
	protected 
void 
Application_Start (
(( )
)) *
{ 	
AreaRegistration 
. 
RegisterAllAreas -
(- .
). /
;/ 0!
RegisterGlobalFilters   !
(  ! "
GlobalFilters  " /
.  / 0
Filters  0 7
)  7 8
;  8 9
RegisterRoutes!! 
(!! 

RouteTable!! %
.!!% &
Routes!!& ,
)!!, -
;!!- .
}"" 	
}## 
}$$ Ÿ+
=C:\PruebasNET\WebGoat-MVC\WebGoat.MVC\Models\AccountModels.cs
	namespace 	
WebGoat
 
. 
MVC 
. 
Models 
{ 
public 

class 
ChangePasswordModel $
{ 
[ 	
Required	 
] 
[		 	
DataType			 
(		 
DataType		 
.		 
Password		 #
)		# $
]		$ %
[

 	
Display

	 
(

 
Name

 
=

 
$str

 *
)

* +
]

+ ,
public 
string 
OldPassword !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
ErrorMessage '
=( )
$str* Y
,Y Z
MinimumLength[ h
=i j
$numk l
)l m
]m n
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
[ 	
Display	 
( 
Name 
= 
$str &
)& '
]' (
public 
string 
NewPassword !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
DataType	 
( 
DataType 
. 
Password #
)# $
]$ %
[ 	
Display	 
( 
Name 
= 
$str .
). /
]/ 0
[ 	
Compare	 
( 
$str 
, 
ErrorMessage  ,
=- .
$str/ i
)i j
]j k
public 
string 
ConfirmPassword %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
public 

class 

LogOnModel 
{ 
[ 	
Required	 
] 
[ 	
Display	 
( 
Name 
= 
$str #
)# $
]$ %
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
[   	
DataType  	 
(   
DataType   
.   
Password   #
)  # $
]  $ %
[!! 	
Display!!	 
(!! 
Name!! 
=!! 
$str!! "
)!!" #
]!!# $
public"" 
string"" 
Password"" 
{""  
get""! $
;""$ %
set""& )
;"") *
}""+ ,
[$$ 	
Display$$	 
($$ 
Name$$ 
=$$ 
$str$$ &
)$$& '
]$$' (
public%% 
bool%% 

RememberMe%% 
{%%  
get%%! $
;%%$ %
set%%& )
;%%) *
}%%+ ,
}&& 
public(( 

class(( 
RegisterModel(( 
{)) 
[** 	
Required**	 
]** 
[++ 	
Display++	 
(++ 
Name++ 
=++ 
$str++ #
)++# $
]++$ %
public,, 
string,, 
UserName,, 
{,,  
get,,! $
;,,$ %
set,,& )
;,,) *
},,+ ,
[.. 	
Required..	 
].. 
[// 	
DataType//	 
(// 
DataType// 
.// 
EmailAddress// '
)//' (
]//( )
[00 	
Display00	 
(00 
Name00 
=00 
$str00 '
)00' (
]00( )
public11 
string11 
Email11 
{11 
get11 !
;11! "
set11# &
;11& '
}11( )
[33 	
Required33	 
]33 
[44 	
StringLength44	 
(44 
$num44 
,44 
ErrorMessage44 '
=44( )
$str44* Y
,44Y Z
MinimumLength44[ h
=44i j
$num44k l
)44l m
]44m n
[55 	
DataType55	 
(55 
DataType55 
.55 
Password55 #
)55# $
]55$ %
[66 	
Display66	 
(66 
Name66 
=66 
$str66 "
)66" #
]66# $
public77 
string77 
Password77 
{77  
get77! $
;77$ %
set77& )
;77) *
}77+ ,
[99 	
DataType99	 
(99 
DataType99 
.99 
Password99 #
)99# $
]99$ %
[:: 	
Display::	 
(:: 
Name:: 
=:: 
$str:: *
)::* +
]::+ ,
[;; 	
Compare;;	 
(;; 
$str;; 
,;; 
ErrorMessage;; )
=;;* +
$str;;, b
);;b c
];;c d
public<< 
string<< 
ConfirmPassword<< %
{<<& '
get<<( +
;<<+ ,
set<<- 0
;<<0 1
}<<2 3
}== 
}>> Î
@C:\PruebasNET\WebGoat-MVC\WebGoat.MVC\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str &
)& '
]' (
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str &
)& '
]' (
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str (
)( )
]) *
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 9
)9 :
]: ;
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[%% 
assembly%% 	
:%%	 

AssemblyVersion%% 
(%% 
$str%% $
)%%$ %
]%%% &
[&& 
assembly&& 	
:&&	 

AssemblyFileVersion&& 
(&& 
$str&& (
)&&( )
]&&) *